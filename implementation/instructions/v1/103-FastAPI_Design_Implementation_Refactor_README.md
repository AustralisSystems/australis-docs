# FastAPI Design Implementation Refactor - Execution Guide

This guide provides comprehensive methods for executing `103-FastAPI_Design_Implementation_Refactor.yaml`, including full execution and selective parsing by YAML key references.

## Quick Start

### Full Execution (First Time)
```
Execute @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml from the beginning
```

### Continuation Instruction (Subsequent Use)
```
Follow the continuation_instruction from @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml
```

### Selective Parsing (Recommended for Re-execution)
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_1' section (Identify and Eliminate Blocking Operations)
```

---

## Execution Methods

### Method 1: Full Execution from Beginning

**Use Case**: First-time execution, need complete context

**Command:**
```
Execute @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml from the beginning
```

**Alternative Formats:**
```
Execute @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml
Load and obey @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml
Follow @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml
```

**What Happens:**
- Loads entire instruction file
- Enters ACTIVE MODE (always enforced during FastAPI code work)
- Reads all sections (architectural principles, async patterns, performance, reliability, workflow)
- Applies FastAPI best practices requirements
- Validates FastAPI compliance

---

### Method 2: Continuation Instruction Execution

**Use Case**: File context already available, quick execution

**Command:**
```
Follow the continuation_instruction from @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml
```

**Alternative Formats:**
```
Execute per continuation_instruction in @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml
Continue per @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml continuation_instruction
```

**What Happens:**
- Uses `continuation_instruction` section directly (lines 757-850)
- Follows summarized workflow steps
- Applies FastAPI asynchronous compliance requirements
- Enforces performance enhancements
- Enforces reliability features

---

### Method 3: Direct Paste

**Use Case**: Maximum speed, no file lookup needed

**Command:**
```
[Paste the entire continuation_instruction section here]
```

**What Happens:**
- Immediate execution without file access
- Uses pasted continuation instruction content
- Fastest method for repeated execution

---

## Selective Parsing Methods (YAML Key References)

### Method 4: Parse and Execute Specific Design Implementation Step

**Use Case**: Execute only one design implementation step

**Step 1 (Identify and Eliminate Blocking Operations):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_1' section
```

**Step 2 (Ensure FastAPI Asynchronous Compliance):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_2' section
```

**Step 3 (Implement Asynchronous Patterns):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_3' section
```

**Step 4 (Implement Performance Enhancements):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_4' section
```

**Step 5 (Implement Reliability Features):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_5' section
```

**Step 6 (Validate FastAPI Asynchronous Compliance):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_6' section
```

**Step 7 (Validate Connection Pooling Implementation):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_7' section
```

**Step 8 (Validate Microservices Architecture Best Practices):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_8' section
```

**Step 9 (Validate Performance Optimization):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_9' section
```

**Step 10 (Validate Reliability Enhancements):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_10' section
```

**Step 11 (Final Compliance Verification):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'design_implementation_steps.step_11' section
```

---

### Method 5: Parse and Execute Specific Workflow Step

**Use Case**: Execute only one workflow step

**Step 1 (Identify Blocking Operations):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_1' section
```

**Step 2 (Convert to Asynchronous):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_2' section
```

**Step 3 (Implement Async Patterns):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_3' section
```

**Step 4 (Add Performance Enhancements):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_4' section
```

**Step 5 (Add Reliability Features):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_5' section
```

**Step 6 (Validate Compliance):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_6' section
```

**Step 7 (Validate Performance):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_7' section
```

**Step 8 (Validate Reliability):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_8' section
```

**Step 9 (Final Verification):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only the 'workflow.steps.step_9' section
```

---

### Method 6: Parse and Extract Specific Sections

**Use Case**: Execute specific architectural principles or patterns

**FastAPI Asynchronous Compliance:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'architectural_principles.fastapi_asynchronous_compliance', and execute asynchronous compliance validation
```

**Asynchronous Patterns:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'asynchronous_patterns', and execute asynchronous patterns validation
```

**Performance Enhancements:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'performance_enhancements', and execute performance enhancements validation
```

**Reliability Features:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'reliability_features', and execute reliability features validation
```

**Connection Pooling:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'performance_enhancements.connection_pooling', and execute connection pooling validation
```

**Error Handling:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'reliability_features.error_handling', and execute error handling validation
```

**Best Practices References:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'best_practices_references', and review all best practices documents
```

---

### Method 7: Parse and Execute with Best Practices Focus

**Use Case**: Execute steps with specific best practices review

**Step 1 with FastAPI Best Practices:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_1' and 'best_practices_references.core_fastapi', then execute Step 1 with FastAPI best practices review
```

**Step 3 with Async/Performance Best Practices:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_3' and 'best_practices_references.async_performance', then execute Step 3 with async/performance best practices review
```

**Step 5 with Reliability Best Practices:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_5' and 'best_practices_references.reliability_resilience', then execute Step 5 with reliability best practices review
```

**Step 8 with Architecture Best Practices:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_8' and 'best_practices_references.architecture_patterns', then execute Step 8 with architecture best practices review
```

---

### Method 8: Parse Multiple Steps

**Use Case**: Execute a range of steps

**Design Steps 1-3 (Identify through Implement Async Patterns):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_1' through 'design_implementation_steps.step_3'
```

**Design Steps 4-5 (Performance through Reliability):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_4' and 'design_implementation_steps.step_5'
```

**Design Steps 6-11 (Validation through Final Verification):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_6' through 'design_implementation_steps.step_11'
```

**Workflow Steps 1-5 (Identify through Add Reliability):**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'workflow.steps.step_1' through 'workflow.steps.step_5'
```

---

### Method 9: Parse Continuation Instruction Only

**Use Case**: Quick execution using continuation instruction without full file load

**Command:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'continuation_instruction' section, and execute that
```

**Alternative:**
```
Read @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract continuation_instruction (lines 757-850), and execute that
```

---

## YAML Structure Reference

Understanding the YAML structure helps you reference specific sections precisely:

```yaml
103-FastAPI_Design_Implementation_Refactor.yaml
├── prompt_name
├── version
├── type
├── language
├── references
├── best_practices_references
│   ├── core_fastapi
│   ├── async_performance
│   ├── reliability_resilience
│   ├── architecture_patterns
│   ├── security_compliance
│   ├── observability_monitoring
│   ├── data_persistence
│   ├── configuration_deployment
│   ├── background_tasks
│   ├── integration_patterns
│   ├── ui_integration
│   ├── code_quality_testing
│   └── templating_scaffolding
├── context
│   ├── role
│   ├── intent
│   ├── workflow
│   └── execution_mode
├── initialization_mode
│   ├── rule
│   ├── behavior
│   ├── required_on_load
│   └── response_template
├── documentation_policy
├── quick_reference
│   ├── protocols
│   └── fastapi_best_practices_summary
├── architectural_principles
│   ├── fastapi_asynchronous_compliance
│   ├── microservices_architecture
│   ├── performance_optimization
│   └── reliability_requirements
├── asynchronous_patterns
│   ├── asyncio_to_thread
│   ├── asyncio_get_running_loop
│   └── thread_pool_executor
├── performance_enhancements
│   ├── connection_pooling
│   │   ├── http_clients
│   │   └── database_connections
│   ├── keep_alive_connections
│   └── asynchronous_file_operations
├── reliability_features
│   ├── error_handling
│   ├── retry_mechanisms
│   ├── circuit_breakers
│   └── connection_health_monitoring
├── design_implementation_steps
│   ├── execution_order
│   ├── blocking_rule
│   ├── best_practices_requirement
│   ├── step_1
│   │   └── best_practices_review
│   ├── step_2
│   │   └── best_practices_review
│   ├── step_3
│   │   └── best_practices_review
│   ├── step_4
│   │   └── best_practices_review
│   ├── step_5
│   │   └── best_practices_review
│   ├── step_6
│   ├── step_7
│   ├── step_8
│   │   └── best_practices_review
│   ├── step_9
│   ├── step_10
│   └── step_11
│       └── best_practices_review
├── validation_checkpoint
│   ├── mandatory
│   ├── rule
│   ├── blocking
│   └── before_completion
│       ├── fastapi_asynchronous_compliance
│       ├── asynchronous_patterns
│       ├── performance_enhancements
│       ├── reliability_features
│       ├── code_quality
│       └── production_readiness
├── workflow
│   ├── protocol
│   ├── focus
│   ├── mode
│   ├── execution_rule
│   ├── blocking_rule
│   ├── activation
│   └── steps
│       ├── step_1
│       ├── step_2
│       ├── step_3
│       ├── step_4
│       ├── step_5
│       ├── step_6
│       ├── step_7
│       ├── step_8
│       └── step_9
├── enforcement
│   ├── strict_mode
│   ├── interpretation_policy
│   ├── wiggle_room
│   ├── blocking_rules
│   ├── violation_response
│   └── no_exceptions
├── output_format
│   ├── on_endpoint_creation
│   └── on_code_modification
├── metadata
└── continuation_instruction
```

---

## YAML Key Reference Examples

### Architectural Principles References

- **All Architectural Principles**: `architectural_principles`
- **FastAPI Asynchronous Compliance**: `architectural_principles.fastapi_asynchronous_compliance`
- **Microservices Architecture**: `architectural_principles.microservices_architecture`
- **Performance Optimization**: `architectural_principles.performance_optimization`
- **Reliability Requirements**: `architectural_principles.reliability_requirements`

### Asynchronous Patterns References

- **All Async Patterns**: `asynchronous_patterns`
- **asyncio.to_thread**: `asynchronous_patterns.asyncio_to_thread`
- **asyncio.get_running_loop**: `asynchronous_patterns.asyncio_get_running_loop`
- **ThreadPoolExecutor**: `asynchronous_patterns.thread_pool_executor`

### Performance Enhancements References

- **All Performance**: `performance_enhancements`
- **Connection Pooling**: `performance_enhancements.connection_pooling`
- **HTTP Clients Pooling**: `performance_enhancements.connection_pooling.http_clients`
- **Database Pooling**: `performance_enhancements.connection_pooling.database_connections`
- **Keep-Alive Connections**: `performance_enhancements.keep_alive_connections`
- **Asynchronous File Operations**: `performance_enhancements.asynchronous_file_operations`

### Reliability Features References

- **All Reliability**: `reliability_features`
- **Error Handling**: `reliability_features.error_handling`
- **Retry Mechanisms**: `reliability_features.retry_mechanisms`
- **Circuit Breakers**: `reliability_features.circuit_breakers`
- **Connection Health Monitoring**: `reliability_features.connection_health_monitoring`

### Design Implementation Steps References

- **Step 1**: `design_implementation_steps.step_1` - Identify and Eliminate Blocking Operations
- **Step 2**: `design_implementation_steps.step_2` - Ensure FastAPI Asynchronous Compliance
- **Step 3**: `design_implementation_steps.step_3` - Implement Asynchronous Patterns
- **Step 4**: `design_implementation_steps.step_4` - Implement Performance Enhancements
- **Step 5**: `design_implementation_steps.step_5` - Implement Reliability Features
- **Step 6**: `design_implementation_steps.step_6` - Validate FastAPI Asynchronous Compliance
- **Step 7**: `design_implementation_steps.step_7` - Validate Connection Pooling Implementation
- **Step 8**: `design_implementation_steps.step_8` - Validate Microservices Architecture Best Practices
- **Step 9**: `design_implementation_steps.step_9` - Validate Performance Optimization
- **Step 10**: `design_implementation_steps.step_10` - Validate Reliability Enhancements
- **Step 11**: `design_implementation_steps.step_11` - Final Compliance Verification

### Workflow Steps References

- **Step 1**: `workflow.steps.step_1` - Identify Blocking Operations
- **Step 2**: `workflow.steps.step_2` - Convert to Asynchronous
- **Step 3**: `workflow.steps.step_3` - Implement Async Patterns
- **Step 4**: `workflow.steps.step_4` - Add Performance Enhancements
- **Step 5**: `workflow.steps.step_5` - Add Reliability Features
- **Step 6**: `workflow.steps.step_6` - Validate Compliance
- **Step 7**: `workflow.steps.step_7` - Validate Performance
- **Step 8**: `workflow.steps.step_8` - Validate Reliability
- **Step 9**: `workflow.steps.step_9` - Final Verification

### Best Practices References

- **All Best Practices**: `best_practices_references`
- **Core FastAPI**: `best_practices_references.core_fastapi`
- **Async/Performance**: `best_practices_references.async_performance`
- **Reliability/Resilience**: `best_practices_references.reliability_resilience`
- **Architecture Patterns**: `best_practices_references.architecture_patterns`
- **Security**: `best_practices_references.security_compliance`
- **Observability**: `best_practices_references.observability_monitoring`

### Validation Checkpoint References

- **All Checkpoints**: `validation_checkpoint.before_completion`
- **FastAPI Compliance**: `validation_checkpoint.before_completion.fastapi_asynchronous_compliance`
- **Async Patterns**: `validation_checkpoint.before_completion.asynchronous_patterns`
- **Performance**: `validation_checkpoint.before_completion.performance_enhancements`
- **Reliability**: `validation_checkpoint.before_completion.reliability_features`
- **Code Quality**: `validation_checkpoint.before_completion.code_quality`
- **Production Readiness**: `validation_checkpoint.before_completion.production_readiness`

---

## Recommended Execution Patterns

### Pattern 1: Parse First, Then Execute (Recommended)

**Workflow:**
1. Parse the entire file to understand structure
2. Index all design steps, workflow steps, and best practices
3. Execute full workflow OR reference specific YAML keys

**Example:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, index all design steps and best practices, then execute only 'design_implementation_steps.step_1' with 'best_practices_references.core_fastapi' applied
```

### Pattern 2: Extract and Execute Specific Section

**Workflow:**
1. Extract specific YAML section
2. Execute only that section

**Example:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'architectural_principles.fastapi_asynchronous_compliance', and execute asynchronous compliance validation
```

### Pattern 3: Parse with Context, Execute Selectively

**Workflow:**
1. Parse file with full context
2. Reference specific keys for execution

**Example:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml with full context, then execute only 'design_implementation_steps.step_1.actions' with 'best_practices_references.core_fastapi' applied
```

### Pattern 4: Execute Design Implementation Phases

**Phase 1: Identification and Conversion (Steps 1-2)**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_1' and 'design_implementation_steps.step_2'
```

**Phase 2: Implementation (Steps 3-5)**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_3' through 'design_implementation_steps.step_5'
```

**Phase 3: Validation (Steps 6-11)**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_6' through 'design_implementation_steps.step_11'
```

---

## Advanced YAML Key Reference Patterns

### Execute Step with Best Practices Review

```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_1' and 'design_implementation_steps.step_1.best_practices_review', then execute Step 1 with best practices review
```

### Execute Multiple Related Sections

```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'architectural_principles.fastapi_asynchronous_compliance', 'asynchronous_patterns', and 'performance_enhancements', then execute with all sections applied
```

### Execute Validation Checkpoint with Step

```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_6' and 'validation_checkpoint.before_completion.fastapi_asynchronous_compliance', then execute Step 6 with validation checkpoint
```

### Execute Performance Enhancements with Connection Pooling

```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'performance_enhancements.connection_pooling' and 'design_implementation_steps.step_4', then execute Step 4 with connection pooling focus
```

---

## Comparison: Full Load vs Selective Parsing

| Aspect | Full Load | Selective Parsing |
|--------|-----------|-------------------|
| **Speed** | Slower | Faster |
| **Token Usage** | Higher | Lower |
| **Context** | Complete | Focused |
| **Best For** | First-time execution | Re-execution, specific steps |
| **Precision** | Broad | Precise |
| **Dependencies** | All loaded | Only needed sections |

---

## Best Practices for Selective Parsing

1. **Always Parse First**: Parse the entire file to understand structure before referencing keys
2. **Use Precise Keys**: Reference exact YAML paths (e.g., `design_implementation_steps.step_1`)
3. **Include Context**: When extracting sections, include necessary dependencies (e.g., best practices review with steps)
4. **Index Steps**: Use "index all design steps and best practices" to understand available options before execution
5. **Follow Step Order**: Always respect the sequential step order (Step 1 → 2 → 3 → ... → 11)
6. **Include Best Practices**: Always include best practices review sections when executing Steps 1-5, 8, 11
7. **Combine Sections**: Extract multiple related sections for complete validation

---

## Common Execution Scenarios

### Scenario 1: First-Time Execution
```
Execute @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml from the beginning
```

### Scenario 2: Execute Step 1 (Identify Blocking Operations) Only
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_1' and 'best_practices_references.core_fastapi', then execute Step 1 with FastAPI best practices review
```

### Scenario 3: Execute Step 4 (Performance Enhancements) Only
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_4' and 'performance_enhancements.connection_pooling', then execute Step 4 with connection pooling focus
```

### Scenario 4: Execute Step 5 (Reliability Features) Only
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_5' and 'reliability_features', then execute Step 5 with reliability features focus
```

### Scenario 5: Execute Continuation Instruction Only
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'continuation_instruction', and execute that
```

### Scenario 6: Execute Implementation Phase (Steps 3-5)
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_3' through 'design_implementation_steps.step_5'
```

### Scenario 7: Execute Validation Phase (Steps 6-11)
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_6' through 'design_implementation_steps.step_11'
```

---

## Quick Reference Cheat Sheet

| What You Want | Command Pattern |
|---------------|----------------|
| **Full execution** | `Execute @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml from the beginning` |
| **Continuation only** | `Follow the continuation_instruction from @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml` |
| **Specific design step** | `Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and execute only 'design_implementation_steps.step_1'` |
| **Step with best practices** | `Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_1' and 'best_practices_references.core_fastapi', then execute Step 1` |
| **Async compliance validation** | `Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'architectural_principles.fastapi_asynchronous_compliance', and execute asynchronous compliance validation` |
| **Connection pooling validation** | `Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'performance_enhancements.connection_pooling', and execute connection pooling validation` |
| **Reliability features validation** | `Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'reliability_features', and execute reliability features validation` |
| **Validation checkpoint** | `Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'validation_checkpoint.before_completion.fastapi_asynchronous_compliance', and execute validation checkpoint` |
| **Best practices review** | `Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'best_practices_references', and review all best practices documents` |

---

## Critical Rules Reference

### Initialization Mode (ACTIVE MODE)

**Key**: `initialization_mode`

**Rule**: ACTIVE MODE - This instruction is ALWAYS ENFORCED during FastAPI code work

**Behavior**:
- MUST check FastAPI compliance before creating or modifying endpoints
- Always enforced - check before EVERY endpoint/service modification

**Response Template**:
```
"FastAPI Design Implementation Refactor (v1.0.0) loaded and acknowledged.
Ready to enforce FastAPI best practices when creating or modifying endpoints.
All FastAPI code will be validated against asynchronous compliance, performance, and reliability standards."
```

---

### Documentation Policy (CODE-ONLY)

**Key**: `documentation_policy`

**Rule**: CODE-ONLY instruction - NO documentation shall be written unless explicitly requested

**Explicit Request Definition**: User must explicitly state 'create documentation' or 'write documentation' - implicit requests DO NOT count

**Exceptions**:
- SPEC protocols must ALWAYS be followed (SPEC creation, updates, lifecycle management) - MANDATORY, NO EXCEPTIONS
- Documentation explicitly requested by user with explicit wording

**Forbidden**:
- Creating README files unless explicitly requested
- Creating markdown documentation files unless explicitly requested
- Creating temporal documentation reports unless explicitly requested
- Writing documentation comments beyond code docstrings

**Required**:
- Code docstrings and type hints (standard Python practice - REQUIRED)
- SPEC lifecycle management (in_progress → done/) - MANDATORY

**Enforcement**: Violation of documentation policy = BLOCKING ISSUE - execution MUST STOP immediately

---

### FastAPI Asynchronous Compliance

**Key**: `architectural_principles.fastapi_asynchronous_compliance`

**Rule**: ALL endpoints MUST operate using non-blocking methods exclusively

**Requirements**:
- Every endpoint must be `async def` (not `def`)
- All asynchronous endpoints must correctly implement the `await` keyword
- Blocking operations are STRICTLY FORBIDDEN within asynchronous environments
- No blocking calls within asynchronous or non-blocking functions

**Enforcement**: Endpoint without `async def` = VIOLATION - MUST convert to async immediately

**Validation**: MUST verify all endpoints use `async def` and `await` correctly

---

### Asynchronous Patterns

**asyncio.to_thread**:
- **Key**: `asynchronous_patterns.asyncio_to_thread`
- **Rule**: MUST use `asyncio.to_thread()` for ALL blocking file I/O operations
- **Purpose**: Maintain non-blocking execution while performing blocking I/O
- **Enforcement**: Blocking file I/O in async function = VIOLATION - MUST wrap with `asyncio.to_thread()`

**asyncio.get_running_loop**:
- **Key**: `asynchronous_patterns.asyncio_get_running_loop`
- **Rule**: MUST use `asyncio.get_running_loop()` with `create_task()` for fire-and-forget operations
- **Purpose**: Schedule background tasks without blocking or awaiting completion
- **Enforcement**: Using deprecated `get_event_loop()` = VIOLATION - MUST use `get_running_loop()`

**ThreadPoolExecutor**:
- **Key**: `asynchronous_patterns.thread_pool_executor`
- **Rule**: MUST use ThreadPoolExecutor for asynchronous operations from synchronous contexts
- **Purpose**: Run async operations from sync code without blocking event loop
- **Enforcement**: Sync blocking call in async context = VIOLATION - MUST use ThreadPoolExecutor

---

### Performance Enhancements

**Connection Pooling**:
- **Key**: `performance_enhancements.connection_pooling`
- **Rule**: MUST implement connection pooling for HTTP clients and database connections
- **HTTP Clients**: `httpx.AsyncClient(limits=httpx.Limits(max_connections=100, max_keepalive_connections=20))`
- **Database**: SQLAlchemy with `pool_size`, `max_overflow`, `pool_pre_ping=True`
- **Enforcement**: HTTP client without connection pooling = VIOLATION - MUST add limits parameter

**Keep-Alive Connections**:
- **Key**: `performance_enhancements.keep_alive_connections`
- **Rule**: MUST enable keep-alive connections in HTTP clients
- **Implementation**: `httpx.AsyncClient` with `limits.max_keepalive_connections > 0`
- **Enforcement**: HTTP client without keep-alive = VIOLATION - MUST enable keep-alive

**Asynchronous File Operations**:
- **Key**: `performance_enhancements.asynchronous_file_operations`
- **Rule**: ALL file operations MUST use `asyncio.to_thread()` to avoid blocking event loop
- **Implementation**: `await asyncio.to_thread(blocking_file_operation, args)`
- **Enforcement**: Blocking file operation in async function = VIOLATION - MUST wrap with `asyncio.to_thread()`

---

### Reliability Features

**Error Handling**:
- **Key**: `reliability_features.error_handling`
- **Rule**: MUST implement comprehensive error handling within asynchronous contexts
- **Requirements**: Try/except blocks around all async operations, proper exception propagation, graceful error recovery, error logging with context
- **Enforcement**: Async operation without error handling = VIOLATION - MUST add try/except

**Retry Mechanisms**:
- **Key**: `reliability_features.retry_mechanisms`
- **Rule**: MUST implement retry mechanisms with exponential backoff in HTTP clients
- **Implementation**: httpx with retry middleware or tenacity library
- **Requirements**: Exponential backoff, maximum retry attempts (typically 3), retry only on transient errors (5xx, network errors)
- **Enforcement**: HTTP client without retry mechanism = VIOLATION - MUST add retry logic

**Circuit Breakers**:
- **Key**: `reliability_features.circuit_breakers`
- **Rule**: MUST deploy circuit breakers in critical components to prevent cascading failures
- **Implementation**: Circuit breaker pattern in tool registry and critical services
- **Requirements**: Open circuit after failure threshold, half-open state for recovery attempts, close circuit after successful recovery
- **Enforcement**: Critical component without circuit breaker = VIOLATION - MUST implement circuit breaker

**Connection Health Monitoring**:
- **Key**: `reliability_features.connection_health_monitoring`
- **Rule**: MUST enable connection health monitoring for database connections
- **Implementation**: `pool_pre_ping=True` in SQLAlchemy connection pool
- **Requirements**: Verify connection validity before use, automatically refresh invalid connections, monitor connection pool health
- **Enforcement**: Database pool without health monitoring = VIOLATION - MUST enable `pool_pre_ping=True`

---

### Design Implementation Steps Order

**Key**: `design_implementation_steps.execution_order`

**Rule**: MANDATORY - MUST follow steps sequentially - CANNOT skip steps

**Blocking Rule**: If ANY step fails, MUST fix before proceeding - NO exceptions

**Best Practices Requirement**: MUST review and implement relevant best practices documents at each step - NO exceptions

**Step 1: Identify and Eliminate Blocking Operations**
- **Key**: `design_implementation_steps.step_1`
- **Best Practices**: FastAPI best practices, error handling patterns
- **Actions**: Scan for blocking operations, convert to non-blocking async tasks
- **Blocking**: Cannot proceed to Step 2 until Step 1 is 100% complete and validated

**Step 2: Ensure FastAPI Asynchronous Compliance**
- **Key**: `design_implementation_steps.step_2`
- **Prerequisite**: Step 1 MUST be 100% complete and validated
- **Best Practices**: FastAPI directory structure, dependency injection
- **Actions**: Verify all endpoints use `async def`, verify `await` usage, convert sync endpoints
- **Blocking**: Cannot proceed to Step 3 until Step 2 is 100% complete and validated

**Step 3: Implement Asynchronous Patterns**
- **Key**: `design_implementation_steps.step_3`
- **Prerequisite**: Step 2 MUST be 100% complete and validated
- **Best Practices**: Object pooling, WebSocket/SSE patterns
- **Actions**: Wrap file I/O with `asyncio.to_thread()`, use `get_running_loop()`, configure ThreadPoolExecutor
- **Blocking**: Cannot proceed to Step 4 until Step 3 is 100% complete and validated

**Step 4: Implement Performance Enhancements**
- **Key**: `design_implementation_steps.step_4`
- **Prerequisite**: Step 3 MUST be 100% complete and validated
- **Best Practices**: Caching strategies, resource pooling
- **Actions**: Configure connection pooling, enable keep-alive, implement caching
- **Blocking**: Cannot proceed to Step 5 until Step 4 is 100% complete and validated

**Step 5: Implement Reliability Features**
- **Key**: `design_implementation_steps.step_5`
- **Prerequisite**: Step 4 MUST be 100% complete and validated
- **Best Practices**: Error handling, resilience patterns, rate limiting, middleware
- **Actions**: Add error handling, implement retries, deploy circuit breakers, enable health monitoring
- **Blocking**: Cannot proceed to Step 6 until Step 5 is 100% complete and validated

**Steps 6-11: Validation Steps**
- **Step 6**: Validate FastAPI Asynchronous Compliance
- **Step 7**: Validate Connection Pooling Implementation
- **Step 8**: Validate Microservices Architecture Best Practices (with architecture best practices review)
- **Step 9**: Validate Performance Optimization
- **Step 10**: Validate Reliability Enhancements
- **Step 11**: Final Compliance Verification (with security, observability, logging, configuration best practices review)

---

### Validation Checkpoints

**Key**: `validation_checkpoint.before_completion`

**Rule**: MUST verify ALL checkpoints before marking complete - NO exceptions, NO partial completions

**Blocking**: If ANY checkpoint fails, completion is BLOCKED - MUST fix and re-verify ALL checkpoints

**FastAPI Asynchronous Compliance**:
- **Key**: `validation_checkpoint.before_completion.fastapi_asynchronous_compliance`
- **Checks**: All endpoints use `async def`, all async endpoints use `await` correctly, no blocking operations in async functions, all file I/O wrapped with `asyncio.to_thread()`
- **Enforcement**: ANY FastAPI compliance violation = BLOCKING - cannot proceed until fixed

**Asynchronous Patterns**:
- **Key**: `validation_checkpoint.before_completion.asynchronous_patterns`
- **Checks**: `asyncio.to_thread()` used for file I/O, `asyncio.get_running_loop()` used (not `get_event_loop()`), ThreadPoolExecutor used for sync-to-async, `create_task()` used for fire-and-forget
- **Enforcement**: ANY async pattern violation = BLOCKING - cannot proceed until fixed

**Performance Enhancements**:
- **Key**: `validation_checkpoint.before_completion.performance_enhancements`
- **Checks**: Connection pooling configured for HTTP clients, connection pooling configured for database connections, keep-alive connections enabled, all file operations use `asyncio.to_thread()`
- **Enforcement**: ANY performance enhancement missing = BLOCKING - cannot proceed until fixed

**Reliability Features**:
- **Key**: `validation_checkpoint.before_completion.reliability_features`
- **Checks**: Comprehensive error handling in all async operations, retry mechanisms with exponential backoff in HTTP clients, circuit breakers in critical components, connection health monitoring enabled
- **Enforcement**: ANY reliability feature missing = BLOCKING - cannot proceed until fixed

**Code Quality**:
- **Key**: `validation_checkpoint.before_completion.code_quality`
- **Checks**: All Python validators pass (mypy 0/0, flake8 0/0), no blocking calls in async functions
- **Enforcement**: ANY validator failure = BLOCKING - cannot proceed until ALL pass

**Production Readiness**:
- **Key**: `validation_checkpoint.before_completion.production_readiness`
- **Checks**: All endpoints are async and non-blocking, connection pooling fully implemented, reliability features fully implemented, performance optimized
- **Enforcement**: ANY production readiness issue = BLOCKING - cannot proceed until fixed

**Completion Gate**: ALL checkpoints MUST pass with 100% compliance - NO exceptions, NO partial passes, NO 'good enough' - ONLY 100% compliance allows completion

---

### Workflow (9 Steps)

**Key**: `workflow`

**Protocol**: `docs/implementation/instructions/04-Execute_Implementation_Phase_Tasks.yaml`

**Focus**: Optimize FastAPI code for streamlined, efficient operation with best practices enforcement

**Mode**: CODE-ONLY - focus on code optimization and refactoring, not documentation

**Execution Rule**: MUST follow steps sequentially - NO skipping steps, NO parallel execution of steps, NO shortcuts

**Blocking Rule**: If ANY step fails, MUST stop and fix before proceeding - NO workarounds

**Activation**:
- **Rule**: Workflow is activated when working with FastAPI endpoints or services
- **Trigger**: Creating or modifying FastAPI endpoints, services, or async operations
- **Always Active**: Prohibition is always enforced - check before EVERY endpoint/service modification

**Steps**:
1. **Identify Blocking Operations** - MUST identify all blocking operations before proceeding
2. **Convert to Asynchronous** - MUST convert all blocking operations to async
3. **Implement Async Patterns** - MUST implement `asyncio.to_thread()`, `get_running_loop()`, ThreadPoolExecutor correctly
4. **Add Performance Enhancements** - MUST add connection pooling and keep-alive
5. **Add Reliability Features** - MUST add error handling, retries, circuit breakers, health monitoring
6. **Validate Compliance** - MUST validate FastAPI compliance
7. **Validate Performance** - MUST validate performance enhancements
8. **Validate Reliability** - MUST validate reliability features
9. **Final Verification** - MUST verify ALL checkpoints pass

---

### Enforcement

**Key**: `enforcement`

**Strict Mode**: true

**Interpretation Policy**: NO interpretations allowed - requirements are LITERAL and ABSOLUTE

**Wiggle Room**: ZERO wiggle room - requirements are IRON CLAD

**Blocking Rules**:
- Non-compliance with FastAPI asynchronous standards = IMMEDIATE STOP - execution BLOCKED until fixed
- Missing performance enhancements = IMMEDIATE STOP - execution BLOCKED until fixed
- Missing reliability features = IMMEDIATE STOP - execution BLOCKED until fixed
- Blocking operations in async functions = IMMEDIATE STOP - execution BLOCKED until fixed
- All validators MUST pass with 0 errors, 0 warnings - NO exceptions, NO 'close enough', ONLY 0/0
- Violation of ANY requirement = BLOCKING ISSUE - execution MUST STOP immediately
- Partial compliance = NON-COMPLIANCE - ONLY 100% compliance is acceptable
- Cannot proceed to next step until current is 100% complete - NO exceptions

**Violation Response**:
- **Action**: STOP immediately
- **Required Steps**: Identify violation → Fix violation → Verify fix → Re-run validation → Confirm 100% compliance
- **Then**: ONLY then can execution continue

**No Exceptions**:
- **Rule**: NO exceptions allowed - requirements are ABSOLUTE
- **Examples**: Cannot say 'this endpoint is simple, blocking is OK' - MUST convert to async; Cannot say 'connection pooling can wait' - MUST implement immediately; Cannot say 'this is good enough' - MUST achieve 100% compliance; Cannot interpret requirements - MUST follow LITERALLY

---

## Best Practices Integration

### Best Practices Review by Step

**Step 1 Best Practices**:
- **Key**: `design_implementation_steps.step_1.best_practices_review`
- **Documents**: FastAPI best practices, error handling patterns
- **Requirement**: MUST review BEFORE identifying blocking operations

**Step 2 Best Practices**:
- **Key**: `design_implementation_steps.step_2.best_practices_review`
- **Documents**: FastAPI directory structure, dependency injection
- **Requirement**: MUST review BEFORE ensuring FastAPI compliance

**Step 3 Best Practices**:
- **Key**: `design_implementation_steps.step_3.best_practices_review`
- **Documents**: Object pooling, WebSocket/SSE patterns
- **Requirement**: MUST review BEFORE implementing async patterns

**Step 4 Best Practices**:
- **Key**: `design_implementation_steps.step_4.best_practices_review`
- **Documents**: Caching strategies, resource pooling
- **Requirement**: MUST review BEFORE implementing performance enhancements

**Step 5 Best Practices**:
- **Key**: `design_implementation_steps.step_5.best_practices_review`
- **Documents**: Error handling, resilience patterns, rate limiting, middleware
- **Requirement**: MUST review BEFORE implementing reliability features

**Step 8 Best Practices**:
- **Key**: `design_implementation_steps.step_8.best_practices_review`
- **Documents**: API gateway, middleware, plugin architecture
- **Requirement**: MUST review BEFORE validating microservices architecture

**Step 11 Best Practices**:
- **Key**: `design_implementation_steps.step_11.best_practices_review`
- **Documents**: Security, observability, logging, configuration
- **Requirement**: MUST review BEFORE final compliance verification

**Execute Step with Best Practices:**
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_1' and 'design_implementation_steps.step_1.best_practices_review', then execute Step 1 with best practices review
```

---

## Tips for Effective Execution

1. **Start with Parse**: Always parse the file first to understand its structure
2. **Use YAML Keys**: Reference exact YAML paths for precision
3. **Index Steps**: Use "index all design steps and best practices" to see available options
4. **Follow Step Order**: Always respect the sequential step order (Step 1 → 2 → 3 → ... → 11)
5. **Include Best Practices**: Always include best practices review sections when executing Steps 1-5, 8, 11
6. **Combine Sections**: Extract multiple related sections for complete validation
7. **Respect ACTIVE MODE**: Remember this instruction is always enforced during FastAPI code work
8. **Follow CODE-ONLY Policy**: Remember documentation policy - CODE-ONLY unless explicitly requested
9. **Validate Checkpoints**: Always execute validation checkpoints before completion

---

## Troubleshooting

### Issue: YAML Key Not Found

**Solution**: Parse the file first to see actual structure:
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml and show YAML structure
```

### Issue: Step Order Not Clear

**Solution**: Extract execution order:
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.execution_order', and review step order
```

### Issue: Best Practices Not Applied

**Solution**: Extract best practices review:
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'design_implementation_steps.step_1.best_practices_review', and execute Step 1 with best practices review
```

### Issue: Validation Checkpoint Failing

**Solution**: Extract specific checkpoint:
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'validation_checkpoint.before_completion.fastapi_asynchronous_compliance', and execute FastAPI compliance validation
```

### Issue: Enforcement Rules Not Applied

**Solution**: Extract enforcement rules:
```
Parse @docs/implementation/instructions/103-FastAPI_Design_Implementation_Refactor.yaml, extract 'enforcement.blocking_rules', and execute enforcement rules validation
```

---

## Quick Reference Summary

### FastAPI Best Practices Summary
- All endpoints must be asynchronous (non-blocking)
- Use `asyncio.to_thread()` for blocking I/O
- Implement connection pooling (HTTP and database)
- Enable keep-alive connections
- Comprehensive error handling
- Retry mechanisms with exponential backoff
- Circuit breakers for critical components
- Connection health monitoring

### Protocols
- 00-Enterprise_Cannonical_Execution_Protocol.yaml
- 01-The_GoldenRule_Execution_Protocol.yaml
- 04-Execute_Implementation_Phase_Tasks.yaml
- 101-Zero_Tolerance_Remediation_Instruction.yaml

---

**Last Updated**: 2025-12-15
**File**: `103-FastAPI_Design_Implementation_Refactor.yaml`
**Version**: 1.0.0
