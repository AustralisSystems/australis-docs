{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://australissystems.github.io/au-sys-docs/schemas/instruction-authoring.schema.json",
  "title": "AU-SYS Instruction Authoring Schema (aligned to MCP-tier artefacts)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "authoring_schema_version",
    "mcp_spec_revision",
    "artifact"
  ],
  "properties": {
    "authoring_schema_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "mcp_spec_revision": {
      "type": "string",
      "const": "2025-11-25"
    },
    "artifact": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "meta",
        "content"
      ],
      "properties": {
        "meta": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "version",
            "schema",
            "id",
            "title",
            "action"
          ],
          "properties": {
            "version": {
              "type": "string"
            },
            "schema": {
              "type": "string",
              "const": "mcp.instruction/v1"
            },
            "id": {
              "type": "string",
              "pattern": "^[a-z0-9_.:-]+$"
            },
            "title": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "action": {
              "type": "string",
              "enum": [
                "read",
                "plan",
                "create-file",
                "modify-files",
                "validate",
                "refactor",
                "execute",
                "halt"
              ],
              "description": "Controlled action type so orchestrators can apply consistent safety rules."
            },
            "tags": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            }
          }
        },
        "content": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "doctrine_refs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Doctrine IDs that govern this instruction."
            },
            "protocol_refs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Protocol IDs that must be complied with during execution."
            },
            "directives": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Optional directive keys applied for this instruction (should correspond to protocol directives)."
            },
            "inputs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Named required inputs/resources (eg a spec file path)."
            },
            "outputs": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Named artefacts produced by execution."
            },
            "steps": {
              "type": "array",
              "description": "Ordered execution steps. Keep steps single-action and testable.",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "id",
                      "description"
                    ],
                    "properties": {
                      "id": {
                        "type": "string"
                      },
                      "description": {
                        "type": "string"
                      },
                      "requires": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "default": []
                      },
                      "produces": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "default": []
                      }
                    }
                  }
                ]
              }
            },
            "variables": {
              "type": "object",
              "description": "Template variables used during execution (name -> metadata).",
              "additionalProperties": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "required": {
                    "type": "boolean"
                  },
                  "default": {},
                  "description": {
                    "type": "string"
                  }
                }
              }
            },
            "halt": {
              "type": "boolean",
              "description": "If true, must pause after completion and await explicit operator authorisation."
            },
            "notes": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "governance": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "owners": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            },
            "status": {
              "type": "string",
              "enum": [
                "draft",
                "review",
                "approved",
                "deprecated"
              ],
              "default": "draft"
            },
            "changeLog": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            }
          }
        },
        "traceability": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "raw": {
              "type": "string"
            },
            "raw_ref": {
              "type": "string",
              "format": "uri"
            },
            "raw_hash": {
              "type": "string",
              "pattern": "^[A-Fa-f0-9]{64}$"
            }
          }
        }
      }
    }
  }
}
