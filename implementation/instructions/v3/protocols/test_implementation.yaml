authoring_schema_version: "1.0.0"
mcp_spec_revision: "2025-11-25"

artifact:
  meta:
    version: "1.0.0"
    schema: "mcp.protocol/v1"
    id: "testing.test_implementation"
    title: "Test Implementation"
    description: "Rules for creating production-ready tests (unit/integration/e2e) with traceable evidence."
    enforce: true
    tags: ["testing", "quality"]

  content:
    related_doctrine: "enterprise.canonical_execution"
    applies_to: ["repo://*"]
    directives:
      - id: "tests_for_new_behavior"
        level: "required"
        statement: "When new production behavior is implemented, corresponding tests MUST be added or updated to cover it."
        rationale: "Prevents regressions and ensures behavior is executable and verifiable."
        verification: "Test changes exist and fail without the implementation, pass with the implementation."

      - id: "pytest_naming_and_structure"
        level: "recommended"
        statement: "For Python projects, tests SHOULD follow pytest naming conventions (test_*.py, test_* functions) and be organized by test type."
        rationale: "Improves discoverability and ensures CI collection works as expected."
        verification: "Tests run under pytest without manual collection tweaks."

      - id: "coverage_target"
        level: "recommended"
        statement: "For unit tests, target at least 80% coverage of new/changed code paths unless the project specifies a different threshold."
        rationale: "Provides a pragmatic baseline while allowing stricter project standards."
        verification: "Coverage report meets configured threshold or documented project standard."

      - id: "deterministic_tests"
        level: "required"
        statement: "Tests MUST be deterministic and must not rely on execution order or hidden global state."
        rationale: "Flaky tests erode trust and block reliable delivery."
        verification: "Re-running tests yields consistent results."

      - id: "production_validation_is_separate"
        level: "required"
        statement: "If a repository defines a production validation suite standard, it MUST be followed for runtime validation (do not substitute unit-test mocks for production validation)."
        rationale: "Runtime validation requirements (real resources / real HTTP) differ from unit testing strategies."
        verification: "Production validation uses the repository's validation suite pattern when required."

    inputs: []
    outputs: []
    notes:
      - "This protocol covers test implementation practices. Runtime production validation is governed by validation protocols (eg validation.real_resources_only, validation.api_real_http)."
    conflicts: []

  governance:
    owners: ["au-sys"]
    status: "draft"
    changeLog:
      - "Migrated from v2 009-PROTOCOL-Test_Implementation-v1.0.0.yaml; extracted enforceable testing directives."

  traceability:
    raw_ref: "repo://docs/implementation/instructions/v2/009-PROTOCOL-Test_Implementation-v1.0.0.yaml"
